<!DOCTYPE html>
{%- comment -%}
    语言检测逻辑：优先使用 page.lang，其次检查 URL 是否包含 /zh/，否则使用 site.lang
{%- endcomment -%}
{%- if page.lang -%}
    {%- assign page_lang = page.lang -%}
{%- elsif page.url contains '/zh/' -%}
    {%- assign page_lang = 'zh' -%}
{%- else -%}
    {%- assign page_lang = site.lang | default: 'en' -%}
{%- endif -%}

<html lang="{%- if page_lang == 'zh' -%}zh-CN{%- else -%}en{%- endif -%}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if page.title %}{{ page.title }} - {% endif %}{{ site.title }}</title>
    <meta name="description" content="{{ page.excerpt | default: site.description | strip_html | truncatewords: 20 }}">
    
    <!-- SEO 标签 -->
    {% seo %}
    
    <!-- 样式表 -->
    <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
    <!-- 网站图标（favicon）：使用 assets/images/logo_main.png -->
    <!-- 使用 relative_url 以兼容 site.baseurl -->
    <link rel="icon" type="image/png" href="{{ '/assets/images/logo_main.png' | relative_url }}">
    <link rel="shortcut icon" href="{{ '/assets/images/logo_main.png' | relative_url }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ '/assets/images/logo_main.png' | relative_url }}">
    
    <!-- 字体 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <header class="site-header">
        <div class="header-content">
            <div class="site-brand">
                <div class="title-wrap" role="banner">
                    <!-- 弹幕容器已移除：保持 logo 与 title 的简洁展示 -->
                    <a href="{{ '/' | relative_url }}" class="brand-link" aria-label="{{ site.title }}">
                        <img src="{{ '/assets/images/logo_main.svg' | relative_url }}" alt="site logo" class="brand-logo">
                    </a>

                    <img src="{{ '/assets/images/title.svg' | relative_url }}" alt="{{ site.title }}" class="title-svg">
                </div>
            </div>

                        <!-- 简化头部：移除冗长的站点描述，使页面头部更简洁 -->
        </div>
    </header>

    <nav class="site-nav">
        <ul class="nav-menu">
            {%- assign nav_items = site.data.navigation[page_lang] -%}
            {%- for item in nav_items -%}
                <li>
                    <a href="{{ item.url | relative_url }}" class="nav-link {% if page.url == item.url %}active{% endif %}">
                        {{ item.title }}
                    </a>
                </li>
            {%- endfor -%}

            {%- comment -%} 语言切换逻辑 {%- endcomment -%}
            <li class="lang-switcher">
                {%- if page_lang == 'zh' -%}
                    {%- assign en_url = page.url | replace_first: '/zh/', '/' -%}
                    {%- if en_url == '/zh/' %}{% assign en_url = '/' %}{% endif -%}
                    <a href="{{ en_url | relative_url }}" class="nav-link" aria-label="Switch to English">EN</a>
                    <span class="separator">/</span>
                    <span class="nav-link active">中</span>
                {%- else -%}
                    {%- assign zh_url = '/zh' | append: page.url -%}
                    {%- if page.url == '/' %}{% assign zh_url = '/zh/' %}{% endif -%}
                    <span class="nav-link active">EN</span>
                    <span class="separator">/</span>
                    <a href="{{ zh_url | relative_url }}" class="nav-link" aria-label="切换到中文">中</a>
                {%- endif -%}
            </li>
        </ul>
    </nav>

    <main class="site-main">
        <div class="container">
            {{ content }}
        </div>
    </main>

    <footer class="site-footer">
        <p>&copy; 2019-2025 致远物理咯咯 | 上海交通大学物理学院致远学院</p>
        <p style="font-size: 0.9em; margin-top: 0.5em;">
            <a href="https://www.sjtu.edu.cn" target="_blank">上海交通大学</a> | 
            <a href="https://zhiyuan.sjtu.edu.cn/" target="_blank">上海交通大学致远学院</a>
        </p>
    </footer>

    <!-- 将 site.baseurl 注入页面，供客户端脚本正确生成带 baseurl 的语言切换 URL -->
    <script>window._SITE_BASEURL = "{{ site.baseurl | default: '' }}";</script>
    <script src="{{ '/assets/js/script.js' | relative_url }}"></script>
</body>
</html>
